<!DOCTYPE html>
<html lang="eng">

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title></title>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" type="text/css" href="../css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Open+Sans:400,600">
    <link rel="stylesheet" type="text/css" href="../css/style.css"/>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
<body>
    <div id="main">
      <h1>Cameroon</h1>
      <div id="chart"></div>
    </div>
    <!-- jQuery -->
    <script type="text/javascript" src="../scripts/js/jquery.js"></script>
    <!-- Bootstrap JavaScript -->
    <script type="text/javascript" src="../scripts/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../scripts/js/d3.js"></script>
    <script>

      var margin = {top: 20, right: 20, bottom: 30, left: 40},
          width = 960 - margin.left - margin.right,
          height = 500 - margin.top - margin.bottom;

      var x0 = d3.scale.ordinal()
          .rangeRoundBands([0, width], .1);

      var x1 = d3.scale.ordinal();

      var y = d3.scale.linear()
          .range([height, 0]);

      var color = d3.scale.ordinal()
          .range(["#98abc5", "#8a89a6", "#7b6888", "#6b486b", "#a05d56", "#d0743c", "#ff8c00"]);

      var xAxis = d3.svg.axis()
          .scale(x0)
          .orient("bottom");

      var yAxis = d3.svg.axis()
          .scale(y)
          .orient("left")
          // .tickFormat(d3.format(".2s"));
          .tickFormat(d3.format('s'));

      // Change D3's SI prefix to more business friendly units
      //      K = thousands
      //      M = millions
      //      B = billions
      //      T = trillion
      //      P = quadrillion
      //      E = quintillion
      // small decimals are handled with e-n formatting.
      var d3_formatPrefixes = ["e-24","e-21","e-18","e-15","e-12","e-9","e-6","e-3","","K","M","B","T","P","E","Z","Y"].map(d3_formatPrefix);

      // Override d3's formatPrefix function
      d3.formatPrefix = function(value, precision) {
          var i = 0;
          if (value) {
              if (value < 0) {
                  value *= -1;
              }
              if (precision) {
                  value = d3.round(value, d3_format_precision(value, precision));
              }
              i = 1 + Math.floor(1e-12 + Math.log(value) / Math.LN10);
              i = Math.max(-24, Math.min(24, Math.floor((i - 1) / 3) * 3));
          }
          return d3_formatPrefixes[8 + i / 3];
      };

      function d3_formatPrefix(d, i) {
          var k = Math.pow(10, Math.abs(8 - i) * 3);
          return {
              scale: i > 8 ? function(d) { return d / k; } : function(d) { return d * k; },
              symbol: d
          };
      }

      function d3_format_precision(x, p) {
          return p - (x ? Math.ceil(Math.log(x) / Math.LN10) : 1);
      }

      var svg = d3.select("body").append("svg")
          .attr("width", width + margin.left + margin.right)
          .attr("height", height + margin.top + margin.bottom)
        .append("g")
          .attr("id", "container")
          .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

      var div = d3.select("body").append("div")
          .attr("class", "tooltip")
          .style("opacity", 0);

      d3.select("#container").on("mouseleave", mouseleave);

      d3.csv("./data/health.csv", function(error, data) {
        var catNames = d3.keys(data[0]).filter(function(key) { return key !== "year" && key !== "country"; });

        data.forEach(function(d) {
          d.cats = catNames.map(function(name) { return {name: name, value: +d[name]}; });
        });

        x0.domain(data.map(function(d) { return d.year; }));
        x1.domain(catNames).rangeRoundBands([0, x0.rangeBand()]);
        y.domain([0, d3.max(data, function(d) { return d3.max(d.cats, function(d) { return d.value; }); })]);

        var year = svg.selectAll(".year")
            .data(data)
          .enter().append("g")
            .attr("class", "g")
            .attr("transform", function(d) { return "translate(" + x0(d.year) + ",0)"; });

        year.selectAll("rect")
            .data(function(d) { return d.cats; })
          .enter().append("rect")
            .attr("width", x1.rangeBand())
            .attr("x", function(d) { return x1(d.name); })
            .attr("y", function(d) { return y(d.value); })
            .attr("height", function(d) { return height - y(d.value); })
            .style("fill", function(d) { return color(d.name); })
            .on("mouseover", mouseover);

        var legend = svg.selectAll(".legend")
            .data(catNames.slice().reverse())
          .enter().append("g")
            .attr("class", "legend")
            .attr("transform", function(d, i) { return "translate(0," + i * 20 + ")"; });

        legend.append("rect")
            .attr("x", width - 18)
            .attr("width", 18)
            .attr("height", 18)
            .style("fill", color);

        legend.append("text")
            .attr("x", width - 24)
            .attr("y", 9)
            .attr("dy", ".35em")
            .style("text-anchor", "end")
            .text(function(d) { return d; });

        svg.append("g") 
            .attr("class", "x axis")
            .attr("transform", "translate(0," + height + ")")
            .call(xAxis);

        svg.append("g")
            .attr("class", "y axis")
            .call(yAxis)
          .append("text")
            .attr("transform", "rotate(-90)")
            .attr("y", 6)
            .attr("dy", ".71em")
            .style("text-anchor", "end")
            .text("$ USD");


      });
      function mouseover(d) {
        var expend = numberWithCommas(d.value);

        d3.select('.tooltip')
            .transition()
            .duration(200)
            .style("opacity", .8);
        d3.select('.tooltip')
            .html("<h4>" + d.name + "</h4>")  
            .html("<h4>" + d.name + "</h4><small>$ USD " + expend + "</small>")  
            .style("left", (d3.event.pageX) + "px")     
            .style("top", (d3.event.pageY - 28) + "px");
      

      // // Fade all the segments.
      // d3.selectAll("path")
      //     .style("opacity", 0.3);
         
    }

    function mouseleave(d) {
      d3.select('.tooltip')
          .transition()
          .duration(200)
          .style("opacity", 0);

      // // Deactivate all segments during transition.
      // d3.selectAll("path").on("mouseover", null);

      // // Transition each segment to full opacity and then reactivate it.
      // d3.selectAll("path")
      //     .transition()
      //     .duration(1000)
      //     .style("opacity", 1)
      //     .each("end", function () {
      //       d3.select(this).on("mouseover", mouseover);
      //     });
    }
    function numberWithCommas(x) {
        return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }
      

      </script>
    <!-- <script type="text/javascript" src=""></script> -->
  </body>
</html>
